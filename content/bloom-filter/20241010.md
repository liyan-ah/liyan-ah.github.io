---
title: 布隆过滤器及其在存储中的应用
description: 本文浅谈一下布隆过滤器。
tags: storage
category: 理论内容
---

## 布隆过滤器解决了什么问题？

### 1.1 布隆过滤器的特性及解决的问题

布隆过滤器由 k 个 hash 算法及 m 位的 bit 数组组成。当需要插入一条数据记录 d 时，会分别计算`hash\_1(d)=h\_1, hash\_2(d)=h\_2, ..., hash\_k(d)=h\_n`的值，并分别设置`m[h\_1]=1, m[h\_2]=1, ..., m[h\_n]=1`。当判断数据记录 d 是否存在时，先取`hash\_1(d)=h\_1, hash\_2(d)=h\_2, ..., hash\_k(d)=h\_n`，然后判断`m[h\_1]==1 && m[h\_2]==1 && ... && m[h\_n]==1`。当上述条件满足时，可知数据记录 d **可能**由布隆过滤器判断为通过，若上述条件不满足，则数据记录 d **一定**被判断为不通过。

由于布隆过滤器中直接对 hash 后的结果进行寻址，单个 hash 算法的时间复杂度为 O(1)。由于存在 k 个 hash 算法，所以单个数据的设置时间复杂度为 O(k)，查询时间复杂度同样为 O(k)。显然当数据量很大时，布隆过滤器的算法会很高效。[算法:布隆过滤器]就给出了一个利用布隆过滤器的思路，使用 RedisBloom 来做数据是否存在判断的案例。

这里给出一布隆过滤器实现的示例：

```Rust
```

### 1.2 假阳性和假阴性

正是由于假阳性的存在，使用布隆过滤器时，一般需要设置允许的假阳性率以及预期的最大 key 的数码。一般由三方库依据这些参数来进行 bit 数组长度的设置[^2]。

## 有哪些存储使用了布隆过滤器？

### 2.1 使用了布隆过滤器的存储

| 存储          | 使用方式                                | 功能介绍                                                                                       | 备注                                                                                                     |
|---------------|-----------------------------------------|------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
| Redis         | 可以通过三方包来提供布隆过滤器的功能。  |                                                                                                |                                                                                                          |
| Arrow（检索） | 允许通过配置开启布隆过滤器。            | 提供 Sbbf 结构体，以 Magic Number 来表示布隆过滤器结果部分。固定 k = 8，依据 fpp 及 ndv 求 m。 |                                                                                                          |
| LevelDB       |                                         |                                                                                                |                                                                                                          |
| RocksDB       |                                         |                                                                                                |                                                                                                          |
| MySQL         | MySQL 中的 MyRocks 引擎支持布隆过滤器。 | MyRocks 是 Facebook 开发的 MySQL 数据库引擎，主要实现 RocksDB 的特性。                         | 由于 MySQL InnoDB 会进行读写，而布隆过滤器无法进行删除（假阴性），因此 InnoDB 默认是不支持布隆过滤器的。 |
| Elasticsearch |                                         |                                                                                                |                                                                                                          |


[^1]: https://brilliant.org/wiki/bloom-filter/。介绍了布隆过滤器的概念，里面的动图很便于理解。
[^2]: https://en.wikipedia.org/wiki/Bloom_filter。对布隆过滤器较完整的介绍。公式推导比较详细。
[^3]: https://dongzl.github.io/2020/03/21/17-Bloom-Filter-Summary/index.html。布隆过滤器实现原理及使用。对布隆过滤器的优缺点介绍的比较好。
[^4]: https://github.com/RedisBloom/RedisBloom。Redis 中的布隆过滤器插件。
[^5]: https://www.x64.ink/archives/1454.html。BloomFilter（布隆过滤器）学习笔记。其中列出了一种布隆过滤器的面试问题及场景。描述了 LevelDB 使用而 MySQL 不使用布隆过滤器的原因。
[^6]: http://mysql.taobao.org/monthly/2017/09/04/。MySQL · myrocks · myrocks之Bloom filter。提到了散列函数的计算公式，RocksDB 使用布隆过滤器的方式。
[^7]: https://myrocks.io/docs/getting-started/。myrocks 官方文档。


[算法:布隆过滤器]: https://www.sev7e0.site/%E7%AE%97%E6%B3%95%EF%BC%9A%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8-bloom-filter
